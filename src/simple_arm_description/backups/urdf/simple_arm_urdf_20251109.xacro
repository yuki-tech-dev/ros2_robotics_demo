<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="simple_arm">

  <!-- =========================
       base (固定台座)
       - 円柱で表現
       - static=true で地面に固定
     ========================= -->
  <link name="base_link">
    <inertial>
      <mass value="5.0"/>
      <inertia ixx="0.2" iyy="0.2" izz="0.2"
              ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0.05"/>
      <geometry>
        <cylinder radius="0.15" length="0.1"/>
      </geometry>
      <material name="gray_base">
        <color rgba="0.7 0.7 0.7 1"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0.05"/>
      <geometry>
        <cylinder radius="0.15" length="0.1"/>
      </geometry>
    </collision>
    <gazebo reference="base_link">
      <static>true</static>
      <mu1>2.0</mu1>
      <mu2>2.0</mu2>
    </gazebo>
  </link>

  <!-- joint1: ベース旋回（Z軸回り） -->
  <joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="link1"/>
    <origin xyz="0 0 0.1" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-3.14" upper="3.14" effort="10" velocity="1.0"/>
  </joint>

  <!-- =========================
       link1 (ベース上の土台)
       - 短めの縦リンク
     ========================= -->
  <link name="link1">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.05" iyy="0.05" izz="0.05"/>
    </inertial>
    <visual>
      <!-- 縦方向に伸びる: z長さ0.3の中心を z=0.15 -->
      <origin xyz="0 0 0.2" rpy="0 0 0"/>
      <geometry>
        <box size="0.22 0.22 0.3"/>
      </geometry>
      <material name="blue">
        <color rgba="0.2 0.4 1.0 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <geometry>
        <box size="0.22 0.22 0.3"/>
      </geometry>
    </collision>
    <gazebo reference="link1">
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
    </gazebo>
  </link>

  <!-- joint2: 肩ピッチ（Y軸回り） -->
  <joint name="joint2" type="revolute">
    <parent link="link1"/>
    <child link="link2"/>
    <!-- link1 の上端 (z=0.3 の半分) に関節配置 -->
    <origin xyz="0 0 0.3" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>

  <!-- =========================
       link2 (肩)
       - 縦にしっかり伸びる肩リンク
     ========================= -->
  <link name="link2">
    <inertial>
      <mass value="3.0"/>
      <inertia ixx="0.1" iyy="0.1" izz="0.1"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0.3" rpy="0 0 0"/>
      <geometry>
        <box size="0.18 0.18 0.5"/>
      </geometry>
      <material name="green">
        <color rgba="0.2 1.0 0.4 1"/>
      </material>
    </visual>

    <collision>
      <origin xyz="0 0 0.25" rpy="0 0 0"/>
      <geometry>
        <box size="0.18 0.18 0.5"/>
      </geometry>
    </collision>
    <gazebo reference="link2">
      <mu1>2.0</mu1>
      <mu2>2.0</mu2>
    </gazebo>
  </link>

  <!-- joint3: 肘ピッチ（Y軸回り） -->
  <joint name="joint3" type="revolute">
    <parent link="link2"/>
    <child link="link3"/>
    <!-- link2 の上端に配置 -->
    <origin xyz="0 0 0.5" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>

  <!-- =========================
       link3 (上腕)
       - 前方に水平に伸びるリンク (X 正方向)
     ========================= -->
  <link name="link3">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.05" iyy="0.05" izz="0.05"
               ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <!-- 水平方向に伸ばす: x長さ0.6 の中心を x=0.3 -->
      <origin xyz="0.3 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.6 0.18 0.18"/>
      </geometry>
      <material name="red">
        <color rgba="1.0 0.3 0.3 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0.3 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.6 0.18 0.18"/>
      </geometry>
    </collision>
    <gazebo reference="link3">
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
    </gazebo>
  </link>

  <!-- joint4: 手首回転（Z軸回り） -->
  <joint name="joint4" type="revolute">
    <parent link="link3"/>
    <child link="link4"/>
    <!-- link3 の前端 (x=0.6 の半分) に配置 -->
    <origin xyz="0.6 0 0" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>

  <!-- =========================
       link4 (前腕)
       - さらに前方に水平に伸びるリンク (X 正方向)
     ========================= -->
  <link name="link4">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.05" iyy="0.05" izz="0.05"
               ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <!-- 水平方向に伸ばす: x長さ0.5 の中心を x=0.25 -->
      <origin xyz="0.25 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.5 0.16 0.16"/>
      </geometry>
      <material name="yellow">
        <color rgba="1.0 1.0 0.3 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0.25 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.5 0.16 0.16"/>
      </geometry>
    </collision>
    <gazebo reference="link4">
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
    </gazebo>
  </link>

  <!-- joint5: 手首ピッチ（Y軸回り） -->
  <joint name="joint5" type="revolute">
    <parent link="link4"/>
    <child link="link5"/>
    <!-- link4 の前端に配置 -->
    <origin xyz="0.5 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>

  <!-- =========================
       link5 (手首ピッチ部)
       - 短い縦リンク (Z 正方向に少し伸ばす)
     ========================= -->
  <link name="link5">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.05" iyy="0.05" izz="0.05"
               ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <!-- 縦方向に短く伸ばす: z長さ0.2 の中心を z=0.1 -->
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size="0.16 0.16 0.2"/>
      </geometry>
      <material name="purple">
        <color rgba="0.6 0.3 0.9 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size="0.16 0.16 0.2"/>
      </geometry>
    </collision>
    <gazebo reference="link5">
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
    </gazebo>
  </link>

  <!-- joint6: 手首ロール（X軸回り） -->
  <joint name="joint6" type="revolute">
    <parent link="link5"/>
    <child link="link6"/>
    <!-- link5 の上端に配置 -->
    <origin xyz="0 0 0.2" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>

  <!-- =========================
       link6 (エンドエフェクタ取付部)
       - 小さめの円柱
     ========================= -->
  <link name="link6">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.05" iyy="0.05" izz="0.05"
               ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <!-- 円柱を少し前に出す: 長さ0.12 の中心を z=0.06 -->
      <origin xyz="0 0 0.06" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.06" length="0.12"/>
      </geometry>
      <material name="gray">
        <color rgba="0.6 0.6 0.6 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.06" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.06" length="0.12"/>
      </geometry>
    </collision>
    <gazebo reference="link6">
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
    </gazebo>
  </link>

  <!-- =========================
       Ray距離センサ (link6 先端付近)
     ========================= -->
  <gazebo reference="link6">
    <sensor name="distance_sensor" type="ray">
      <!-- 円柱先端側へ少しオフセット -->
      <pose>0 0 0.1 0 0 0</pose>
      <update_rate>30</update_rate>
      <always_on>true</always_on>
      <ray>
        <scan>
          <horizontal>
            <samples>1</samples>
            <resolution>1</resolution>
            <min_angle>0</min_angle>
            <max_angle>0</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.01</min>
          <max>2.0</max>
          <resolution>0.01</resolution>
        </range>
      </ray>
      <plugin name="gazebo_ros_ray_sensor" filename="libgazebo_ros_ray_sensor.so">
        <ros>
          <namespace>simple_arm</namespace>
          <remapping>~/out:=/simple_arm/distance</remapping>
        </ros>
        <output_type>sensor_msgs/Range</output_type>
        <radiation_type>ultrasound</radiation_type>
      </plugin>
    </sensor>
  </gazebo>

</robot>